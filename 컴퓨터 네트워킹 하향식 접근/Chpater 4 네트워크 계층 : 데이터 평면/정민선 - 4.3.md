### 인터넷 네트워크 계층 패킷 = **데이터그램(datagram)**

### **IPv4 데이터그램 포맷**

- **프로토콜**
    - IP 데이터그램이 트랜스포트 계층(TCP, UDP 등)에서 어떤 프로토콜을 사용하는지 명시
    - 상위 계층에서의 처리 방식을 결정
- **TTL (Time to Live, 8비트)**
    - 데이터그램이 네트워크를 무한히 순환하지 않도록 제한
    - 각 라우터를 통과할 때마다 1씩 감소하며, 0이 되면 폐기
- **헤더 체크섬**
    - 데이터그램 헤더의 오류 감지
    - TTL 필드 변경 등으로 인해 라우터에서 매번 재계산
- **출발지와 목적지 IP 주소**
    - 출발지 : 데이터를 보낸 장치의 IP 주소
    - 목적지 : 데이터를 받을 장치의 IP 주소
- **데이터(페이로드)**
    - 데이터그램의 핵심 내용, 대부분 트랜스포트 계층(TCP/UDP) 데이터를 포함
    - 데이터그램의 존재 이

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/57f51903-6b15-4d91-97fa-aa24b7fc28c5/db18f014-33a0-4ccb-b6f2-1a31f7a684eb/f0620e44-e0e5-4cba-b2e9-39fbb4dbcb54.png)

| **항목** | **TCP** | **UDP** |
| --- | --- | --- |
| **헤더 크기** | IP 헤더 20바이트 + TCP 헤더 20바이트 = 총 40바이트 오버헤드 | IP 헤더 20바이트 + UDP 헤더 8바이트 = 총 28바이트 오버헤드 |
| **헤더 체크섬** | 항상 체크섬 계산하여 오류 감지 | 선택적 체크섬(비활성화 가능) |
| **주요 사용 사례** | HTTP, FTP, 이메일(SMTP), 원격 접속(Telnet) | 실시간 스트리밍(VoIP), DNS, DHCP |

### IP 할당과 데이터 전송 경로 설정을 위한 관리 방식

1. 클래스 주소 체계
    
    IP 주소를 A, B, C, D, E 클래스로 나눠 네트워크와 호스트의 비트를 고정적으로 구분하는 방법
    
    네트워크 크기에 따라 유연하게 IP주소를 할당하지 못한다. 
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/57f51903-6b15-4d91-97fa-aa24b7fc28c5/06ea93eb-0c93-4f39-9806-bc45e868bc43/image.png)
    
2. 서브넷
    
    큰 네트워크를 작은 서브넷으로 나눔으로써 자원의 낭비를 줄이고 네트워크 관리 효율성 향상시키는 방법이다.
    
    호스트나 라우터에서 각 인터페이스를 분리하여 고립된 네트워크를 만들고 해당 종단점이 인터페이스의 끝이 되는 것이다. 고립된 네트워크가 서브넷이다.
    
    기존 클래스 주소의 네트워크 비트에서 **일부 호스트 비트를 서브넷 비트로 전환**하여 사용한다. (서브넷 마스크 사용)
    
3. CIDR
    
    클래스 주소체계의 경직된 네트워크/호스트 비트 구분을 제거한다. 서브넷 마스크를 일반화하여 **더 세밀한 네트워크 분할이 가능하다.**
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/57f51903-6b15-4d91-97fa-aa24b7fc28c5/1c845cb8-18ed-4bea-b69b-0b32321432bd/image.png)
    

|  | **특징** | 보완법 |
| --- | --- | --- |
| **클래스 주소체계** | 고정된 네트워크/호스트 비트 비율 (A, B, C 클래스) | 네트워크 크기 유연성 부족 → 서브넷 도입으로 보완 |
| **서브넷** | 네트워크를 작은 단위로 나눔, 서브넷 마스크로 네트워크/호스트 구분 | 서브넷 마스크도 클래스 기반 제약 존재 → CIDR로 보완 |
| **CIDR** | 네트워크 프리픽스를 자유롭게 설정, 서브넷 마스크 일반화 | 네트워크 크기에 따른 IP 자원의 효율적 활용 가능 |

### 브로드 캐스트

특정 서브넷 내의 모든 장비에 데이터를 전송하는 것

각 관리방법에 따라 범위가 달라진다.

- 클래스 주소체계 : 네트워크 전체에 브로드캐스트 가능(예: `255.255.255.255`)
- 서브넷 : 서브넷별로 브로드캐스트 주소 지정(예: `192.168.1.255`)
- CIDR : 유연한 서브넷 구성이 가능하므로 브로드캐스트 범위도 세밀하게 설정 가능

### DHCP (Dynamic Host Configuration Protocol) : IP 주소 동적할당 (= 효율적 할당)

네트워크에 연결된 장치가 자동으로 IP 주소를 할당받을 수 있게 해주는 프로토콜

- **플러그 앤 플레이**: 사용자 설정 없이 자동 연결 가능 (수동 IP 설정이 필요없다, 자동화)
- **임대 기간**: IP 주소는 일정 기간 동안만 유효(**기존 TCP 연결 유지가 어려울 수 있음**)

⇒ 클래스/서브넷/CIDR 관리 방법과 연동하여 IP 주소를 효율적으로 할당, 브로드캐스트를 통해 서버 탐색 및 주소를 제공

### 네트워크 주소 변환 (NAT) : IP 주소 부족 & 보안 문제 해결 방법

네트워크에서 주소 할당 및 트래픽 라우팅의 효율성을 높이기 위해 사용되는 기술

주로 **사설 IP 주소**를 사용하는 네트워크에서 공인 IP 주소로 변환하여 인터넷과의 통신을 가능하게 함

- **IP 주소 절약**: 하나의 공인 IP 주소를 여러 장치가 공유할 수 있기 때문에, 공인 IP 주소의 부족 문제를 해결할 수 있다.
- **보안**: 외부에서 내부 네트워크의 상세한 정보를 알 수 없기 때문에 **보안상 이점**이 있다.

NAT 환경에서 **서버 연결 문제**나 **외부 접근 제한** 등 문제가 발생할 수 있다. 왜냐하면 창구가 하나(**단일 IP주소** 사용) 외부에서 직접적 접근이 어려우니 서버 호스트 문제가 발생할 수 있다.

⇒ 해당 문제를 해결하기 위해 포트포워딩, NAT순회, VPN등 방법 필요

### **IPv6 데이터그램 포맷**

**변화점**

1. 주소 비트 확장 32→128비트 : 주소 고갈 문제 해결
2. 간소화된 헤더 : 40바이트 고정 길이 헤더
3. 헤더 체크섬 제거 : 데이터 링크, 트랜스포트 계층에서 수행

**단편화/재결합**

송신자/수신자가 처리한다. 기존에는 라우터가 처리하였다. (속도 빨라짐)

데이터그램이 너무 크면 폐기하고 ICMP 오류메세지를 송신자에게 보내 데이터그램 크기를 조정할 수 있도록 한다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/57f51903-6b15-4d91-97fa-aa24b7fc28c5/04d3c34a-ab15-42a8-806e-d3ef029a1de3/image.png)

### **터널링 : IPv4에서 IPv6로의 전환**

네트워크 전환이전에 데이터를 전송하기 위해 터널링 사용

IPv6 패킷을 캡슐화하여 패캣의 페이로드(데이터)에 담아 IPv4네트워크를 통해 전달한다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/57f51903-6b15-4d91-97fa-aa24b7fc28c5/0ff22e79-6e7e-4e36-a08d-da7876a1d881/image.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/57f51903-6b15-4d91-97fa-aa24b7fc28c5/24619d6c-002f-4ff1-8394-844379f064b2/image.png)