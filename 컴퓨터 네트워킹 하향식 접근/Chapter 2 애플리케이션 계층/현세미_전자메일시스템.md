## 전자메일 시스템 구성요소

### **1. 사용자 에이전트(user agent)**

- 메일리더
- 사용자가 메시지를 읽고, 작성하고, 전달하고, 저장할 수 있도록 도움
- ex) 마이크로소프트 아웃룩, 애플 메일

### **2. 메일 서버**

- 전자메일 인프라의 중심
- 출력 메시지 큐와 메일 박스로 구성
- 수신자는 메일 서버에 자신의 메일 박스를 가지며, 이 메일 박스는 메시지를 저장하고 관리함
- 메시지가 송신자의 메일 서버에서 수신자의 메일 서버로 전달, 수신자의 메일 박스에 저장

### **3. SMTP**

- 인터넷 전자메일을 위한 주요 애플리케이션 계층 프로토콜
- TCP를 사용하여 송신자의 메일 서버에서 수신자의 메일 서버로 전송(신뢰성)
- 클라이언트와 서버 모델 다름, 모든 메일은 서버에서 실행

**특징**

- TCP 연결 - 25번 포트 사용 (신뢰성 있는 데이터 전송)
- 전송 단계는 핸드셰이킹, 메시지 전송, 연결 종료 로 이루어짐
- 메시지는 7-bit ASCII 텍스트 문자로만 구성 → 큰 첨부 파일, 비디오 파일 전송 제한

### **이메일 전송 과정**

1. 송신자 user agent 에서의 메일 작성 후 mail server로 전달
2. 송신자 메일 서버의 출력 메시지 큐 ( outgoing message queue ) 에 저장
3. 수신자 메일 서버로 전송
4. 전송 불가시 ( 수신자의 user agent SMTP 서버가 꺼져있다거나 고장난 경우 ) 30분 단위로 재전송 시도, 정해진 기간동안 전송 불가시 중단 및 송신자에게 통보 
(-> 메일 서버의 큐가 필요한 이유)
5. 수신자 메일 서버의 수신자 메일박스 ( mailbox ) 에 저장
6. 수신자 user agent 에서 메일 서버의 메일박스의 메일 읽기 및 관리하기

![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F0M93N%2FbtrsqCjDLDx%2FcaJMtDTncG6n50Rxt23E1K%2Fimg.png)

- 메일 서버의 메일 박스는 실제로 구축을 하면 DB 와 같다. 그러므로 수신자는 메일 서버에 있는 DB 에 HTTP 통신으로 메일 데이터를 읽고 쓰고 삭제하게 된다.

### SMTP vs HTTP

공통점

- 두 프로토콜 모두, 한 호스트에서 다른 호스트로 파일을 전송하는데 이용
- 지속 가능한 연결 사용
- 둘다 아스키 형태의 command/response를 사용
- status code를 사용

차이점

- SMTP
    - client가 server에 push
    - 메시지가 7bit 아스키 포맷이어야 함
    - 포트를 따로 하여 한 메시지로 만듦
    - 메시지 마지막에 CRLF.CRLF를 사용
- HTTP
    - client가 server에서 pull
    - 메시지 포맷 제한 없음
    - 객체에 캡슐화 방식
    

### 메일 메시지 포맷

전자 메일 메시지는  **헤더(Header)**와 **본문(Body)**으로 구성

- 헤더(Header) : 엄청 많은 정보들( From, To, Subject, Body Format 등등)
    - From, To : 발신자, 수신자 이메일 주소(필수 헤더)
- Blank line : 공백
- Body :전달할 메일의 내용들이 포함

![image](http://www.ktword.co.kr/img_data/2233_1.JPG)

### POP3와 IMAP

POP3와 IMAP은 유저가 메일서버에서 메일을 받기 위한 프로토콜

**POP 3 (Post Office Protocol)** 

- TCP 포트번호 110번 사용
- 메일 서버에 저장된 메일을 로컬 PC로 가져오는 역활 (단방향 클라이언트 서버 프로토콜)
- 로컬 PC에서 다운 시 서버에서는 이메일 삭제 (서버 설정 가능)
- 하나의 캄퓨터에서  오프라인만 지원

**IMAP (Internet Message Access Protocol)**

- TCP 포트번호 143번 사용
- POP 서버와 달리 중앙 서버에서 동기화 되어 모든 장치에서 동일한 메일 폴더 확인 가능
- 메일 서버에 저장되어 있어 로컬 PC에 문제 발생 시 이메일에 영향 X
- 서버에 이메일 실시간이 존재하며 온/오프 라인 지원

![image](https://cdn.imweb.me/upload/S20210713e59ce6c5de599/a7ba327d67f78.png)

- 일반적으로 전자 메일 클라이언트에 보내기 및 받기 기능을 모두 제공하기 위해 SMTP와 IMAP를 함께 사용