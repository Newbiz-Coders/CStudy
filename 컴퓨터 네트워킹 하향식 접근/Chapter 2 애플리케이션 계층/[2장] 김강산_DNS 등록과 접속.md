# DNS 등록

- 다음 4대의 서버가 있는 상황
    - 서버 1 - **메인서버**
        - 서비스 제공
        - IP : `203.0.113.100`
    - 서버 2 - **주 책임 DNS 서버**
        - 서버 1의 IP를 알려주는 DNS 서버
        - IP : `203.0.113.1`
    - 서버 3 - **부 책임 DNS 서버**
        - 주 책임 서버(서버2)에 장애가 발생할 경우, 대신 서버 1의 IP를 알려주는 DNS 서버
        - IP : `203.0.113.2`
    - 서버 4 - **메일서버**
        - 이메일 송수신 처리
        - IP : `203.0.113.200`
- 등록할 도메인
    - `www.cstudy.net` 으로 접속 가능하게 설정
    - `@cstudy.net` 으로 송신되는 메일을 받을 수 있게 함

## DNS 등록 과정
![제목 없는 다이어그램](https://github.com/user-attachments/assets/4171224c-2451-4f7b-9d96-345116d615df)

### 등록 기관 도메인 신청

- 등록 기관(DNS Registrar)에 해당 도메인의 등록을 요청
    - 등록 기관이 등록 가능한 도메인인지 확인한 후, 요금 청구 및 등록 진행
    - 이미 사용중인 도메인일 경우, 기존 소유자와 협상 필요

---

### 책임 DNS 서버 정보 제공

- 주책임 서버와 부책임 서버의 DNS 정보를 제공
    - 주책임 서버 : `dns1.cstudy.net` `(203.0.113.1)`
    - 부책임 서버 : `dns2.cstudy.net` `(203.0.113.2)`

---

### TLD 서버에 레코드 삽입

- 등록 기관이 `.net` TLD 서버에 다음 정보를 등록한다.
    - Type NS : `cstudy.net` → `dns1.cstudy.net`
        - `cstudy.net` 으로 접속하면, `dns1.cstudy.net` 에서 질의를 처리하도록 안내
    - Type A : `dns1.cstudy.net` → `203.0.113.1` **(Glue Record)**
        - TLD 서버의 주 역할은 **NS 레코드 반환** 이기 떄문에, 실제로는 IP 주소를 반환하지 않는다.
        - 하지만, 네임서버(`dns1.cstudy.net`)가 도메인의 하위 도메인(`cstudy.net`)일 경우 **순환 참조 문제**가 발생할 수 있다.
        - 순환참조를 해결하기 위해 사용한다 → **Glue Record 사용**
- 부책임 서버 또한 동일
    - Type NS: `cstudy.net` → `dns2.cstudy.net`
    - Type A: `dns2.cstudy.net` → `203.0.113.2`

## 책임 NS 서버 설정

### 주책임 서버에 `cstudy.net` 도메인과 관련된 DNS 레코드 등록

- Type A : `www.cstudy.net` → `203.0.113.100`
    - `www.cstudy.net` 은 `203.0.113.100` 으로 매핑된다.
- Type MX : `cstudy.net` → `mail.cstudy.net`
    - `@cstudy.net`으로 발송되는 메일이 `mail.cstudy.net` 메일 서버로 연결되도록 설정한다.

### 부책임 DNS 서버와 동기화

- 부책임 서버(`dns2.kangsan.net`)는 주책임 서버의 레코드를 복제해, 백업 역할을 수행한다. → 장애 시 부책임 서버가 요청 처리

# 주소창에 DNS 입력

![제목 없는 다이어그램 (2)](https://github.com/user-attachments/assets/5afcc701-7f2b-460c-865e-d933015536db)



## 브라우저의 DNS 캐시 확인

- 로컬 캐시(운영체제 또는 브라우저 캐시)에 `www.cstudy.net` 와 매핑된 IP 주소를 찾는다.
    - 캐시에 있다면 :  바로 연결
    - 캐시가 없다면 : **DNS 로컬 서버 질의**
        - 이후 반환된 값을 캐시에 저장

## 로컬 DNS 서버로 질의

- 사용자의 ISP에서 제공하는 DNS 서버
    - 서울의 KT DNS 서버 : `192.168.1.1`
- 브라우저가 ISP의 로컬 DNS 서버로 요청을 보낸다.
- 로컬 DNS 서버 또한 자신의 캐시를 확인한다.
    - 캐시에 있다면 : IP 주소 브라우저 반환
    - 캐시에 없다면 : **DNS 계층 구조 탐색**
        - 이후 반환된 값을 캐시에 저장

## DNS 계층 구조 탐색

### 루트 DNS 서버 질의

- DNS 계층 구조의 최상단 위치 서버
    - 미국 버지니아주 A 루트 서버 : `198.41.0.4`
- 로컬 DNS 서버 : `www.cstudy.net` 의 정보 요청
- 루트 DNS 서버 : `.net` TLD 서버 주소 반환

### TLD DNS 서버 질의

- 특정 TLD(`.com` , `.net` , `kr` 등)에 대한 정보 관리
    - 한국에 위치한 Verisign의  `.net` 도메인 관리 TLD 서버 : `204.0.112.9`
- 로컬 DNS 서버 : `.net` TLD 서버에게 질의
- TLD DNS 서버 : `kangsan.net` 의 책임 DNS 서버 주소 반환

### 책임 DNS 서버 질의

- 특정 도메인에 대한 최종적인 권한을 가지는 서버
    - `dns1.cstudy.net` : `203.0.113.1`
- 로컬 DNS 서버 : 해당 책임 서버에게 질의
- TLD DNS 서버 : `www.cstudy.net` 의 메인 서버 주소인 `203.0.113.100` 반환

---

## 브라우저에게 IP 주소 전달

- 최종적으로 얻은 IP 주소 `203.0.113.100` 을 브라우저에 전달.
- 브라우저는 이 IP 주소와 TCP 연결 후 HTTP 요청을 보낸다.
    - 이후 리소스(HTML, CSS, JS,이미지)를 주고받는다.
- 받은 리소스를 브라우저에 반환하고, 브라우저는 렌더링하여 웹 페이지를 볼 수 있게 한다.
